var Piecon={};var currentFavicon=null;var originalFavicon=null;var originalTitle=null;var canvas=null;var options={};var defaults={color:"#ff0084",background:"#bbb",shadow:"#fff",fallback:false};var retina=!!(window.devicePixelRatio);var ua=(function(){var a=navigator.userAgent.toLowerCase();return function(b){return a.indexOf(b)!==-1}}());var browser={ie:ua("msie"),chrome:ua("chrome"),webkit:ua("chrome")||ua("safari"),safari:ua("safari")&&!ua("chrome"),mozilla:ua("mozilla")&&!ua("chrome")&&!ua("safari")};var getFaviconTag=function(){var b=document.getElementsByTagName("link");for(var c=0,a=b.length;c<a;c++){if(typeof b[c]!=="undefined"&&b[c]!==null&&(b[c].getAttribute("rel")==="icon"||b[c].getAttribute("rel")==="shortcut icon")){return b[c]}}return false};var removeFaviconTag=function(){var b=document.getElementsByTagName("link");var d=document.getElementsByTagName("head")[0];for(var c=0,a=b.length;c<a;c++){if(typeof b[c]!=="undefined"&&b[c]!==null&&(b[c].getAttribute("rel")==="icon"||b[c].getAttribute("rel")==="shortcut icon")){d.removeChild(b[c]);break}}};var setFaviconTag=function(a){removeFaviconTag();var b=document.createElement("link");b.type="image/x-icon";b.rel="icon";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)};var getCanvas=function(){if(!canvas){canvas=document.createElement("canvas");if(retina){canvas.width=32;canvas.height=32}else{canvas.width=16;canvas.height=16}}return canvas};var drawFavicon=function(a){var b=getCanvas();var d=b.getContext("2d");var a=a||0;var e=currentFavicon;var c=new Image();c.onload=function(){if(d){d.clearRect(0,0,b.width,b.height);d.beginPath();d.moveTo(b.width/2,b.height/2);d.arc(b.width/2,b.height/2,Math.min(b.width/2,b.height/2),0,Math.PI*2,false);d.fillStyle=options.shadow;d.fill();d.beginPath();d.moveTo(b.width/2,b.height/2);d.arc(b.width/2,b.height/2,Math.min(b.width/2,b.height/2)-2,0,Math.PI*2,false);d.fillStyle=options.background;d.fill();if(a>0){d.beginPath();d.moveTo(b.width/2,b.height/2);d.arc(b.width/2,b.height/2,Math.min(b.width/2,b.height/2)-2,(-0.5)*Math.PI,(-0.5+2*a/100)*Math.PI,false);d.lineTo(b.width/2,b.height/2);d.fillStyle=options.color;d.fill()}setFaviconTag(b.toDataURL())}};if(!e.match(/^data/)){c.crossOrigin="anonymous"}c.src=e};var updateTitle=function(a){if(a>0){document.title="("+a+"%) "+originalTitle}else{document.title=originalTitle}};Piecon.setOptions=function(b){options={};for(var a in defaults){options[a]=b.hasOwnProperty(a)?b[a]:defaults[a]}return this};Piecon.setProgress=function(b){if(!originalTitle){originalTitle=document.title}if(!originalFavicon||!currentFavicon){var a=getFaviconTag();originalFavicon=currentFavicon=a?a.getAttribute("href"):"/favicon.ico"}if(!isNaN(parseFloat(b))&&isFinite(b)){if(!getCanvas().getContext||browser.ie||browser.safari||options.fallback==true){return updateTitle(b)}else{if(options.fallback==="force"){updateTitle(b)}}return drawFavicon(b)}return false};Piecon.reset=function(){if(originalTitle){document.title=originalTitle}if(originalFavicon){currentFavicon=originalFavicon;setFaviconTag(currentFavicon)}};Piecon.setOptions(defaults);define(function(b,a,c){c.exports=Piecon});